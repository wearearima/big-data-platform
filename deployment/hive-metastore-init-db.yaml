apiVersion: batch/v1
kind: Job
metadata:
  name: init-hms-db
spec:
  template:
    spec:
      # ttlSecondsAfterFinished: 120 # it's supposed to work form v1.23 (https://kubernetes.io/docs/concepts/workloads/controllers/job/#ttl-mechanism-for-finished-jobs)
      containers:
      - name: hive-metastore-init
        image: danasca/hive-metastore
        command: ["/opt/apache-hive-metastore-3.0.0-bin/bin/schematool", "--verbose", "--initSchema", "-dbType", "postgres"]
        volumeMounts:
          - name: metastore-site
            mountPath: /opt/apache-hive-metastore-3.0.0-bin/conf/metastore-site.xml
            subPath: metastore-site.xml
      volumes:
        - name: metastore-site
          configMap:
            name: metastore-site-config
      restartPolicy: OnFailure
  backoffLimit: 6
